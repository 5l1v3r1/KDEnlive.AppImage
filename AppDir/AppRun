#!/bin/bash

DIR="`dirname \"$0\"`" 
DIR="`( cd \"$DIR\" && pwd )`"
export APPDIR=$DIR

export LD_PRELOAD=$DIR/exec_wrapper.so

export APPIMAGE_ORIGINAL_QML2_IMPORT_PATH=$QML2_IMPORT_PATH
export APPIMAGE_ORIGINAL_LD_LIBRARY_PATH=$LD_LIBRARY_PATH
export APPIMAGE_ORIGINAL_QT_PLUGIN_PATH=$QT_PLUGIN_PATH
export APPIMAGE_ORIGINAL_XDG_DATA_DIRS=$XDG_DATA_DIRS
export APPIMAGE_ORIGINAL_XDG_CONFIG_HOME=$XDG_CONFIG_HOME
export APPIMAGE_ORIGINAL_PATH=$PATH

export APPIMAGE_ORIGINAL_MLT_REPOSITORY=$MLT_REPOSITORY
export APPIMAGE_ORIGINAL_MLT_DATA=$MLT_DATA
export APPIMAGE_ORIGINAL_MLT_ROOT_DIR=$MLT_ROOT_DIR
export APPIMAGE_ORIGINAL_MLT_PROFILES_PATH=$MLT_PROFILES_PATH
export APPIMAGE_ORIGINAL_MLT_PRESETS_PATH=$MLT_PRESTES_PATH


export QML2_IMPORT_PATH=$DIR/usr/lib/qt5/qml:$QML2_IMPORT_PATH
export LD_LIBRARY_PATH=$DIR/usr/lib/:$LD_LIBRARY_PATH
export QT_PLUGIN_PATH=$DIR/usr/lib/qt5/plugins/
export XDG_DATA_DIRS=$DIR/usr/share/:$XDG_DATA_DIRS
export XDG_CONFIG_HOME=$HOME/.config/kdenlive-appimage/
export PATH=$DIR/usr/bin:$PATH
export KDE_FORK_SLAVES=1

export MLT_REPOSITORY=$DIR/usr/lib/mlt/
export MLT_DATA=$DIR/usr/share/mlt/
export MLT_ROOT_DIR=$DIR/usr/
export MLT_PROFILES_PATH=$DIR/usr/share/mlt/profiles/
export MLT_PRESETS_PATH=$DIR/usr/share/mlt/presets/
export SDL_AUDIODRIVER=alsa
export XDG_CURRENT_DESKTOP=

export APPIMAGE_STARTUP_QML2_IMPORT_PATH=$QML2_IMPORT_PATH
export APPIMAGE_STARTUP_LD_LIBRARY_PATH=$LD_LIBRARY_PATH
export APPIMAGE_STARTUP_QT_PLUGIN_PATH=$QT_PLUGIN_PATH
export APPIMAGE_STARTUP_XDG_DATA_DIRS=$XDG_DATA_DIRS
export APPIMAGE_STARTUP_XDG_CONFIG_HOME=$XDG_CONFIG_HOME
export APPIMAGE_STARTUP_PATH=$PATH

export APPIMAGE_STARTUP_MLT_REPOSITORY=$MLT_REPOSITORY
export APPIMAGE_STARTUP_MLT_DATA=$MLT_DATA
export APPIMAGE_STARTUP_MLT_ROOT_DIR=$MLT_ROOT_DIR
export APPIMAGE_STARTUP_MLT_PROFILES_PATH=$MLT_PROFILES_PATH
export APPIMAGE_STARTUP_MLT_PRESETS_PATH=$MLT_PRESETS_PATH
export APPIMAGE_STARTUP_SDL_AUDIODRIVER=$SDL_AUDIODRIVER
export APPIMAGE_STARTUP_XDG_CURRENT_DESKTOP=$XDG_CURRENT_DESKTOP

kdenlive --config kdenlive-appimagerc $@
